<html>
  <head>
    <style>
      td{
        padding:0px 20px;
      }
      input{
        width:100%;
      }
      .addIt{
        color: red;
        font-size: 30px;
        cursor: pointer;
      }
      .removeIt{
        color: blue;
        font-size: 30px;
        line-height: 15px;
        cursor: pointer;
      }
      tfoot td{
        position: relative;
      }
    </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/zepto/1.1.3/zepto.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/handlebars.js"></script>

    <script id="entry-template" type="text/x-handlebars-template">
      {{#each offers}}
        <tr item_id="{{id}}">
          <td>{{description}}</td>
          <td> {{type}} </td>
          <td>{{offer_id}} </td>
          <td><input checked=true type=checkbox></input> </td>
          <td><div class="removeIt">-</div></td>
        </tr>
      {{/each}}
    </script>    

    <script>
      var socket = io.connect('http://localhost');
      socket.on('news', function (data) {
        console.log(data);
        socket.emit('my other event', { my: 'data' });
      });
    </script>

    <script>
      $(function(){
        var entry = $("#entry-template").html();
        var entry_template = Handlebars.compile(entry);

        $.ajax({
          url: "/offers",
          success: function(data){
            $("table").append(entry_template({offers:data}));
          }
        })
        $("table").on("click",".removeIt",function(e){
          var row = $(e.currentTarget).parent().parent();
          $.ajax({
            url:"/offers/"+row.attr("item_id"),
            type: "DELETE",
            success: function(){
              row.remove();
            }
          })
        })

        $(".addIt").click(function(){
          var type = $("#type").val(),
              description = $("#description").val(),
              offer_id = $("#offer_id").val(),
              data = {type:type, description:description, offer_id:offer_id}
          $.ajax({
            url: "/offers",
            type: "POST",
            data: data,
            success:function(res){
              data.id = res.id
              $("table").append(entry_template({offers:[data]}));
            },
            error:function(){
              alert("error adding offer")
            }
          })
        })

      })
    </script>
  </head>
  <body>
    <table>
      <thead>
        <tr>
          <th>Description</th>
          <th>Type</th>
          <th>offer id</th>
          <th>Use?</th>
        </tr>
      </thead>
      <tbody>
      </tbdoy>
      <tfoot>
        <tr id="add">
          <td><input id="description" type=text></input></td>
          <td><select id="type"><option value="complete">Complete</option><option value="fsi">FSI</option></select></td>
          <td><input id ="offer_id" type=text></input></td>
          <td><div class="addIt">+</div></td>
        </tr>
      </tfoot>
    </table>
    
  </body>
</html>